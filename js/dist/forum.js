(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>_,extend:()=>P,utils:()=>O});const n=flarum.core.compat["forum/app"];var r=t.n(n);const o=flarum.core.compat["common/extend"],s=flarum.core.compat["forum/states/DiscussionListState"];var i=t.n(s);const c=flarum.core.compat["forum/components/DiscussionListItem"];var a=t.n(c);function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}const p=flarum.core.compat["common/Component"];var l=t.n(p);const f=flarum.core.compat["common/utils/string"];function h(t,e){var n=(new DOMParser).parseFromString(t,"text/html"),r=function(t){0!==e?t.nodeType!==Node.TEXT_NODE?Array.from(t.childNodes).forEach(r):t.textContent.length<e?e-=t.textContent.length:(t.textContent=t.textContent.substring(0,e)+"...",e=0):t.parentNode.removeChild(t)};return r(n.body),n.body.innerHTML}var d=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).post=void 0,e.length=void 0,e.richExcerpt=void 0,e}var n,r;r=t,(n=e).prototype=Object.create(r.prototype),n.prototype.constructor=n,u(n,r);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.post=this.attrs.post,this.length=this.attrs.length,this.richExcerpt=this.attrs.richExcerpt},o.view=function(){return m("div",{className:"Synopsis-excerpt"},this.getContent())},o.getContent=function(){var t,e;return this.richExcerpt?m.trust(h(null!=(e=this.contentRich())?e:"",this.length)):(0,f.truncate)(null!=(t=this.contentPlain())?t:"",this.length)},o.contentRich=function(){return this.post.contentHtml()},o.contentPlain=function(){return this.post.contentPlain()},e}(l());const y=flarum.core.compat["common/extenders"];var g=t.n(y);const x=flarum.core.compat["tags/common/models/Tag"];var v=t.n(x);const b=[new(g().Model)(v()).attribute("richExcerpts").attribute("excerptLength")],P=[].concat(b);var _={Excerpt:d},O={truncateHtml:h};r().initializers.add("fof-synopsis",function(){(0,o.extend)(i().prototype,"requestParams",function(t){"string"==typeof t.include?t.include=[t.include]:t.include=t.include||[],"first"===r().forum.attribute("synopsis.excerpt_type")?t.include.push("firstPost"):t.include.push("lastPost")}),(0,o.extend)(a().prototype,"infoItems",function(t){if(!r().forum.attribute("synopsis.disable_when_searching")||!r().discussions.params.q){var e=this.attrs.discussion,n=e.tags()||[],o="first"===r().forum.attribute("synopsis.excerpt_type")?e.firstPost():e.lastPost(),s=n.map(function(t){return t.excerptLength()}).filter(function(t){return"number"==typeof t}),i=s.length>0?Math.min.apply(Math,s):r().forum.attribute("synopsis.excerpt_length"),c=n.map(function(t){return t.richExcerpts()}),a=r().forum.attribute("synopsis.rich_excerpts");if(c.includes(!1)&&(a=!1),0!==i&&o){var u=m(d,{post:o,length:i,richExcerpt:a});t.add("excerpt",u,-100),t.add("excerptM",u,-100)}}})})})(),module.exports=e})();
//# sourceMappingURL=forum.js.map